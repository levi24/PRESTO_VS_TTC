---
title: The Rise of PRESTO Positively Impacts the Usage of the TTC for the Residents
  of Toronto
author: "Rachit Srivastava"
date: "April 23rd, 2021"
thanks: "Code and data are available at: https://github.com/levi24/PRESTO_VS_TTC"
output:
  pdf_document: default
  html_document: default
abstract: With the rapid increase in digital commodities and on-the-go customer experiences
  for TTC (Toronto Transit Commission) Transit riders, a study was conducted to see
  the shift in transit fare sales in the past decade between physical fares (i.e.
  cash, tokens, or passes) and digital fares from PRESTO cards. When looking at the
  TTC sales matrix from year to year, there is an increase in usage of the TTC where
  most of the sales derive directly from the PRESTO sales rather than physical fares
  regardless of the type of fare; whether the fare pertains to a single-fare ticket
  or monthly passes. Similarly, the relationship between PRESTO sales and the sales
  for rail transits, like subway and SRT, perceived a positive increase in usage in
  the past decade, alluding to the riders being more interested in using the TTC for
  a more faster and efficient ride experience around Toronto. It is quite evident
  that Torontonians value the explicit interaction of being efficient and quick when
  it comes to using the TTC, by using this insight the TTC can slowly transition into
  using PRESTO as their main source of selling fares while increasing the development
  of subways to cater to the needs of Toronto’s TTC riders.
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library, include=FALSE}
#install.packages("opendatatoronto")
library(opendatatoronto)
library(here)
library(knitr)
library(readr)
library(janitor)
library(huxtable)
library(dplyr)
library(kableExtra)
library(ggplot2)
library(plyr)
#library(gridExtra)
```

```{r data, include=FALSE}
ttc_data <- read_csv(here::here("inputs","data","1985-2019-analysis-of-ridership - 1985-2019 ACTUALS.csv"))
```

```{r clean-data, include=FALSE}
ttc_clean_data <-
  janitor::clean_names(ttc_data) %>%
  select(fare_media,x2019,x2018,x2017,x2016,x2015,x2014,x2013,x2012,x2011,x2010,x2009)

ttc_clean_data[ttc_clean_data == "N/A"] <- "0"
```

```{r data-for-paper, include=FALSE}
presto_vs_ttc <- 
  ttc_clean_data %>%
  #sort(colnames(ttc_clean_data$fare_media)) %>% Comments: Wanted to sort the table alphabetically so that the reader can see all of the similar data together. This would also allow for the charts to also show coherent comparisons. 
  filter(fare_media %in% c("CASH",
                           "TOKENS",
                           "TICKETS",
                           "PRESTO - ADULT SINGLE RIDE",
                           "PRESTO - SENIOR SINGLE RIDE",
                           "PRESTO - YOUTH SINGLE RIDE",
                           "PRESTO - FREE CHILD RIDE"
                               )
         )
```

## Introduction
There has been a rise of TTC fares and the usage of the TTC transit by Torontonians in the past decade, giving rise to contactless smart cards encrypted with NFC called the PRESTO card which allows riders to use the TTC without the need for any physical fares. PRESTO is a payment system that works across the city of Toronto for all transit systems to make the experience of a rider more secure and convenient to help them commute from one place to another. While TTC is one of the main ways for people to commute and travel across the city, it will be great to see what aspects of TTC are more prevalent in Torontonian’s riding experience. This will help hone onto a specific sector of TTC and help improve the experience further to lessen the pain for the TTC riders. 

The study focused on assessing the total number of sales for PRESTO, a digital payment system for quick fares, and total number of sales for physical fares, like cash, tokens, passes, or tickets, for Torontonians from 2009 - 2019. This study was conducted by looking at a TTC dataset obtained from the Toronto Open Data Portal, that focused on illustrating the information about the sales of the fares for both digital and physical assets as well as distinguishing the amount of fares for the types of transits that TTC offers. Since the study aimed to look into the trajectory of the sales from a large period of time, looking at the characteristics of the total number of sales per year seemed to be the most appropriate data to analyze for this study. By visualizing this data over a period of time, it gives us a great sense of how the ticket sales increased or decreased in a specific portion of the TTC ecosystem while identifying the main reasoning for that relationship. When comparing these variables, it shows that there is an increase in the usage of the TTC from 2009 - 2019, where the majority of those sales came from PRESTO sales and Rail transit sales. This further elaborates on the behaviour of Torontonians while using the TTC service and its products as they are more inclined to take a type of transit that is convenient, fast, efficient, and gets them to their destination without any hiccups. The TTC can use this knowledge to further push their agenda in strengthening that specific sector in their roadmap to improve the experience further so TTC riders continue to utilize their services according to their liking. 

## Data
The data discussed in this paper is extracted from the opendatatoronto portal and has been captured from 1985 to 2019. The matrix ecompasses the total number of TTC rides that a Torontotonian has made in all of those years, where the numbers detailed in each column is the total number of rides for that year under that specific “ride” category. The dataset has a wide variety of data like: 

• type of fare(PRESTO, cash, tokens, tickets, passes, etc.), \
• type of transit(subway, bus, and rail), \
• age group (adult, senior, and youth), \
• and the time of the ride (weekday or weekends).

For the purpose of this study, the data that is being manipulated in this study is to look at the trajectory of the type of fares that Torontonians have used in the past/recent decade (2009 - 2019). As well as look at the total amount of rides per category based on the age group as the total numbers for the types of fares have been divided up by the age group specifically. Hence, in order to learn the true trajectory of all Torontonians and the data provided around the usage of the TTC, we will need to look at the total usage of the transit system for every single age group. 

Moreover, the dataset has many other breakdowns when the variable for the types of fares is concerned. The dataset is filled with numbers around the wide variety of services that TTC offers to their customers as there are a lot of ways a person can use the TTC. To further elaborate, the dataset contains data on:

• single ride fare,\
• two-time fare (back and forth rides),\
• monthly passes, \
• weekly passes, \
• post-secondary passes,\
• two hour rides, \
• free rides,\
• and many others

The paper will ignore the data around most of these types of fares except for the single fare ticket sales for the TTC in general. This accounts for both PRESTO fares and physical TTC fares like: cash, tokens, and tickets, where the physical fares like the two-time fares and the different types of passes will be ignored for this study. Also, another thing to note is that the total number of fares listed in the dataset is listed in the thousandths value. In other words, some data in the csv file is listed in single or double digits but that does not mean that there were less than 10 types of sales for that specific category of fares for the year. Instead, it means that there were less than 10,000 sales for that specific type of sale for that year. This could be the case due to a new service being adopted by the city or a late adoption of that service in the year which could have caused such an outlier in the data. 

Lastly, the data that is presented in the dataset separates the different types of fares by age group (adult, senior, and youth). In order to see the full trajectory and comparison between the digital and physical fares of TTC in the past/recent decade, the data will need to be aggregated at the end to see a more visually accurate comparison of the types of fares.


## Results
```{r table1, echo=FALSE}
knitr::kable(presto_vs_ttc, 
             "latex", booktabs = T, 
             col.names = c("Type of Fare", 
                           "2019", 
                           "2018", 
                           "2017", 
                           "2016", 
                           "2015", 
                           "2014", 
                           "2013", 
                           "2012",
                           "2011",
                           "2010",
                           "2009"),
             align = c("l","l","l","l","l","l","l","l","l","l","l","r"),
             caption = "Total Number of People Using PRESTO and TTC",
             ) %>%
  row_spec(0,bold=TRUE) %>% 
  kable_styling(full_width = F, latex_options = c("striped", "scale_down"))
```

```{r pie-chart-2019, echo=FALSE}
#Wanted to show a visual representation of the different types of fares in total for the most recent year in question (2019). Inside the pie chart, I wanted to show a percentage of data or the name of the type of fare on the pie chart but it did not work. To make it less confusing, I ended up making a more clear difference in the colours of the data.
ggplot(presto_vs_ttc, aes(x="", y = x2019, fill = fare_media)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values=c("#f58231", "#55DDE0", "#ffe119", "#911eb4", "#4363d8", "#e6194B", "#3cb44b")) +
  geom_text(aes(x=1.6, label = fare_media), color = "black", size=2, position = position_stack(vjust = 0.5)) + 
  labs(fill = NULL, title = "TTC Fare Breakdown - 2019") +
  theme(plot.title = element_text(face = "bold")) +
  theme_void() 
```

```{r pie-chart-2009, echo=FALSE}
#Shows the total TTC fares in the year 2009
ggplot(presto_vs_ttc, aes(x="", y = x2009, fill = fare_media)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values=c("#f58231", "#55DDE0", "#ffe119", "#911eb4", "#4363d8", "#e6194B", "#3cb44b")) +
  geom_text(aes(x=1.6, label = fare_media), color = "black", size=2, position = position_stack(vjust = 0.5)) + 
  labs(fill = NULL, title = "TTC Fare Breakdown - 2009") +
  theme(plot.title = element_text(face = "bold")) +
  theme_void() 
```


## Discussion

## References

## Appendix

Below is a list of pie charts for the other years if you want to see a more detailed view on all the years in between. 


```{r pie-chart-2018, echo=FALSE}
ggplot(presto_vs_ttc, aes(x="", y = x2018, fill = fare_media)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values=c("#f58231", "#55DDE0", "#ffe119", "#911eb4", "#4363d8", "#e6194B", "#3cb44b")) +
  geom_text(aes(x=1.6, label = fare_media), color = "black", size=2, position = position_stack(vjust = 0.5)) + 
  labs(fill = NULL, title = "TTC Fare Breakdown - 2018") +
  theme(plot.title = element_text(face = "bold")) +
  theme_void() 
```

```{r pie-chart-2017, echo=FALSE}
ggplot(presto_vs_ttc, aes(x="", y = x2017, fill = fare_media)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values=c("#f58231", "#55DDE0", "#ffe119", "#911eb4", "#4363d8", "#e6194B", "#3cb44b")) +
  geom_text(aes(x=1.6, label = fare_media), color = "black", size=2, position = position_stack(vjust = 0.5)) + 
  labs(fill = NULL, title = "TTC Fare Breakdown - 2017") +
  theme(plot.title = element_text(face = "bold")) +
  theme_void() 
```

```{r pie-chart-2016, echo=FALSE}
ggplot(presto_vs_ttc, aes(x="", y = x2016, fill = fare_media)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values=c("#f58231", "#55DDE0", "#ffe119", "#911eb4", "#4363d8", "#e6194B", "#3cb44b")) +
  geom_text(aes(x=1.6, label = fare_media), color = "black", size=2, position = position_stack(vjust = 0.5)) + 
  labs(fill = NULL, title = "TTC Fare Breakdown - 2016") +
  theme(plot.title = element_text(face = "bold")) +
  theme_void() 
```

```{r pie-chart-2015, echo=FALSE}
ggplot(presto_vs_ttc, aes(x="", y = x2015, fill = fare_media)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values=c("#f58231", "#55DDE0", "#ffe119", "#911eb4", "#4363d8", "#e6194B", "#3cb44b")) +
  geom_text(aes(x=1.6, label = fare_media), color = "black", size=2, position = position_stack(vjust = 0.5)) + 
  labs(fill = NULL, title = "TTC Fare Breakdown - 2015") +
  theme(plot.title = element_text(face = "bold")) +
  theme_void() 
```

```{r pie-chart-2014, echo=FALSE}
ggplot(presto_vs_ttc, aes(x="", y = x2014, fill = fare_media)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values=c("#f58231", "#55DDE0", "#ffe119", "#911eb4", "#4363d8", "#e6194B", "#3cb44b")) +
  geom_text(aes(x=1.6, label = fare_media), color = "black", size=2, position = position_stack(vjust = 0.5)) + 
  labs(fill = NULL, title = "TTC Fare Breakdown - 2014") +
  theme(plot.title = element_text(face = "bold")) +
  theme_void() 
```

```{r pie-chart-2013, echo=FALSE}
ggplot(presto_vs_ttc, aes(x="", y = x2013, fill = fare_media)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values=c("#f58231", "#55DDE0", "#ffe119", "#911eb4", "#4363d8", "#e6194B", "#3cb44b")) +
  geom_text(aes(x=1.6, label = fare_media), color = "black", size=2, position = position_stack(vjust = 0.5)) + 
  labs(fill = NULL, title = "TTC Fare Breakdown - 2013") +
  theme(plot.title = element_text(face = "bold")) +
  theme_void() 
```

```{r pie-chart-2012, echo=FALSE}
ggplot(presto_vs_ttc, aes(x="", y = x2012, fill = fare_media)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values=c("#f58231", "#55DDE0", "#ffe119", "#911eb4", "#4363d8", "#e6194B", "#3cb44b")) +
  geom_text(aes(x=1.6, label = fare_media), color = "black", size=2, position = position_stack(vjust = 0.5)) + 
  labs(fill = NULL, title = "TTC Fare Breakdown - 2012") +
  theme(plot.title = element_text(face = "bold")) +
  theme_void() 
```

```{r pie-chart-2011, echo=FALSE}
ggplot(presto_vs_ttc, aes(x="", y = x2011, fill = fare_media)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values=c("#f58231", "#55DDE0", "#ffe119", "#911eb4", "#4363d8", "#e6194B", "#3cb44b")) +
  geom_text(aes(x=1.6, label = fare_media), color = "black", size=2, position = position_stack(vjust = 0.5)) + 
  labs(fill = NULL, title = "TTC Fare Breakdown - 2011") +
  theme(plot.title = element_text(face = "bold")) +
  theme_void() 
```

```{r pie-chart-2010, echo=FALSE}
ggplot(presto_vs_ttc, aes(x="", y = x2010, fill = fare_media)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values=c("#f58231", "#55DDE0", "#ffe119", "#911eb4", "#4363d8", "#e6194B", "#3cb44b")) +
  geom_text(aes(x=1.6, label = fare_media), color = "black", size=2, position = position_stack(vjust = 0.5)) + 
  labs(fill = NULL, title = "TTC Fare Breakdown - 2010") +
  theme(plot.title = element_text(face = "bold")) +
  theme_void() 
```


## Code that did not work

Below is all of the code that I tried but did not work or failed to comply in any shape or form. Also, these codes were not the only ones that did not work but wanted to show you that I tried. There were others I forgot to document...


```{r pie-comparison}
#I combined all pie charts to show the most drastic change in the decade from the most recent year to the oldest year in question of the study.
#grid.arrange(pie2019, pie2018, pie2017, pie2016, pie2015, pie2014, pie2013, pie2012, pie2011, pie2010, pie2009)
#Combining did not work.
```


```{r calculations}
#I GIVE UP! I spent days in combining the data for cash, tickets, and tokens together and I just cannot get it to work. The intention was to combine the strings of data into one row of data to easily visualize and compare between the different types of fares and the years. Without combining the data together, the numbers for each fare is out of order and not in chronological/alphabetical/categorical order.
#dffare <- data.frame(
  #fare = presto_vs_ttc$fare_media,
  #twenty_nineteen = strtoi(c(presto_vs_ttc$x2019)),
  #twenty_eighteen = strtoi(presto_vs_ttc$x2018),
  #twenty_seventeen = strtoi(presto_vs_ttc$x2017),
  #twenty_sixteen = strtoi(presto_vs_ttc$x2016),
  #twenty_fifteen = strtoi(presto_vs_ttc$x2015),
  #twenty_fourteen = strtoi(presto_vs_ttc$x2014),
  #twenty_thirteen = strtoi(presto_vs_ttc$x2013),
  #twenty_twelve = strtoi(presto_vs_ttc$x2012),
  #twenty_eleven = strtoi(presto_vs_ttc$x2011),
  #twenty_ten = strtoi(presto_vs_ttc$x2010),
  #two_thousand_nine = strtoi(presto_vs_ttc$x2009)
#) 
#ddply(dffare,"fare",numcolwise(sum))
#new_dffare <- 
  #dffare %>% 
  #group_by(fare) %>% 
  #summarise(twenty_nineteen = sum(twenty_nineteen))
```

```{r multiple-regression-model}
#ttc_vs_presto_model <- 
 # lm(x2019 ~ x1 + fare_media, data = ttc_clean_data)
#summary(ttc_vs_presto_model)
```


